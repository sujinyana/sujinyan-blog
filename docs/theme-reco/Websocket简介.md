---
title: Websocket简介以及遇到的问题
date: 2019-08-10 18:30:15
tags: [websocket]
---



#### 介绍：

Websocket是HTML5下一种新的协议，全双工通信，它能更好的节省服务器资源和带宽并达到实时通讯的目的。

它与HTTP一样通过已建立的TCP连接来传输数据。

Websocket是一种双向通讯协议，在建立连接后，Websocket客户端和服务端都能主动向对方发送或接收数据。

像当时我做的第一个项目中，要实现消息推送，之前用的是Ajax轮询，也就是每隔固定的时间，发送一次请求，保持最新的状态，后来改造成了Websocket长连接，减少了网络请求数，节约可用带宽。

#### 遇到的问题：

在开发的过程中遇到的问题， 前端和后端都是一台服务器，一一对应，没有出现问题，但当使用Nginx负载均衡的时候，后台服务器大于一台，这样就无法一一对应，建立不起连接，后来我将Nginx负载均衡的策略由默认的轮询策略改成了ip_hash，这样就可以通过session_id实现一一对应。

#### 重连的问题：

Websocket存在一个心跳包机制，客户端每隔一段时间会向服务器发送一个数据包，证明自己还活着，并确认服务器端还活着（回传数据包），如果网络断开连接的时候，则需要重连，在指定的时间内服务器端并没有返回心跳响应消息，可以使用ws.close关闭连接，在onclose事件内，可以调用reconnect事件进行重连操作。